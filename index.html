<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulário MailerLite com DataLayer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 1rem;
        }

        .ml-embedded {
            max-width: 400px;
            width: 100%;
            padding: 20px;
            background-color: #f6f6f6;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            color: #333;
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- MailerLite Universal -->
    <script>
        (function(w,d,e,u,f,l,n){w[f]=w[f]||function(){(w[f].q=w[f].q||[])
        .push(arguments);},l=d.createElement(e),l.async=1,l.src=u,
        n=d.getElementsByTagName(e)[0],n.parentNode.insertBefore(l,n);})
        (window,document,'script','https://assets.mailerlite.com/js/universal.js','ml');
        ml('account', '1404722');
    </script>
    <!-- End MailerLite Universal -->
</head>
<body class="bg-gradient-to-br from-slate-900 to-slate-700 text-white selection:bg-sky-500 selection:text-white">

    <div class="container mx-auto p-6 bg-slate-800 shadow-2xl rounded-xl max-w-2xl w-full">
        <header class="mb-8 text-center">
            <h1 class="text-4xl font-bold text-sky-400">Assine nossa Newsletter!</h1>
            <p class="text-slate-400 mt-2">Receba as últimas novidades e dicas diretamente na sua caixa de entrada.</p>
        </header>

        <!-- 
          INSTRUÇÕES IMPORTANTES PARA O FORMULÁRIO MAILERLITE:
          1. O script abaixo funcionará com os nomes de campo padrão do MailerLite (`email`, `name`).
          2. Se você tiver um campo de telefone, certifique-se de que o nome do campo seja `phone`.
          3. **CRUCIAL**: Crie um campo personalizado OCULTO no seu formulário MailerLite.
             O "Nome do campo" deve ser `event_id_hidden`. O script usará este campo para enviar um ID único ao seu webhook.
        -->
        <section id="mailerliteFormSection" class="mt-8 text-center w-full">
            <div class="ml-embedded" data-form="fnu5le"></div>
        </section>
        <!-- Fim do Formulário MailerLite -->
    </div>

... (todo tu HTML y el formulario de MailerLite está aquí arriba) ...

    </div> <!-- Este es el div que cierra tu container -->

<!-- SCRIPT DE DEPURACIÓN v3: ESPIONAJE DE MENSAJES (MessageEvent) -->
<script>
    console.log("DEBUG v3: Script de espionaje de mensajes cargado.");

    // Escuchamos CUALQUIER mensaje que llegue a la ventana principal.
    window.addEventListener('message', function(event) {
        
        // Filtramos para ver solo los mensajes que podrían venir de MailerLite.
        if (event.origin && event.origin.includes('mailerlite')) {
            
            console.log("-----------------------------------------");
            console.log("¡ÉXITO POTENCIAL! Mensaje recibido de un origen de MailerLite:", event.origin);
            console.log("-----------------------------------------");
            
            // Mostramos TODOS los datos del evento para inspeccionarlos.
            console.log("Datos completos del mensaje (event.data):");
            console.dir(event.data);

            // Intentamos procesarlo como si fuera el evento de éxito
            if (event.data && event.data.type === 'ml-embedded:form:success') {
                console.log("¡CONFIRMADO! Este es el evento de éxito que buscábamos.");

                try {
                    const data = event.data.data; // Los datos del formulario están un nivel más adentro
                    console.log("Datos del formulario extraídos:", data);

                    const dataLayerPayload = {
                        event: 'lead_form_submit_SUCCESS', // Usamos un nombre nuevo para estar seguros
                        form_data_raw: data, // Enviamos los datos crudos para verlos en GTM
                        event_id: data.fields.event_id_hidden || 'fallback-uuid-' + Date.now(),
                        user_data: {
                            email: data.fields.email,
                            phone: data.fields.Teléfono,
                            name: data.fields.Nombre,
                            last_name: data.fields.Apellido
                        }
                    };

                    console.log("Payload final para dataLayer:", dataLayerPayload);

                    window.dataLayer = window.dataLayer || [];
                    window.dataLayer.push(dataLayerPayload);

                    console.log("¡PUSH A DATALAYER REALIZADO! Revisa GTM.");

                } catch (e) {
                    console.error("ERROR al procesar los datos del mensaje de éxito.", e);
                }
            }
        }
    });

    // Mantenemos el listener original como respaldo, por si acaso.
    document.addEventListener('ml-embedded:form:success', function(event) {
        console.log("DEBUG v3: El listener original 'ml-embedded:form:success' también se disparó. Esto es inesperado pero bueno.");
        // Si este se dispara, el código anterior debería haber funcionado.
        // Puedes añadir aquí el dataLayer.push si es necesario.
    });

</script>
<!-- FIN DEL SCRIPT DE DEPURACIÓN v3 -->

</body>
</html>
