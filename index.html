<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tienda de Pr√°ctica GTM</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Estilos personalizados adicionales si son necesarios */
        body {
            font-family: 'Inter', sans-serif; /* Fuente agradable */
        }
        .product-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        .btn {
            transition: background-color 0.3s ease, transform 0.2s ease;
        }
        .btn:hover {
            transform: translateY(-2px);
        }
        .message-box {
            animation: fadeIn 0.5s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gradient-to-br from-slate-900 to-slate-700 text-white min-h-screen flex flex-col items-center justify-center p-4 selection:bg-sky-500 selection:text-white">

    <div class="container mx-auto p-6 bg-slate-800 shadow-2xl rounded-xl max-w-2xl w-full">
        <header class="mb-8 text-center">
            <h1 class="text-4xl font-bold text-sky-400">Tienda de Pr√°ctica GTM</h1>
            <p class="text-slate-400 mt-2">Un lugar para simular el proceso de compra y aprender GTM.</p>
        </header>

        <section id="productSection" class="mb-8">
            <div class="product-card bg-slate-700 p-6 rounded-lg shadow-lg">
                <img src="https://placehold.co/600x400/334155/e2e8f0?text=Producto+Incre√≠ble"
                     alt="Imagen de Producto Incre√≠ble"
                     class="w-full h-64 object-cover rounded-md mb-6 shadow-md"
                     onerror="this.onerror=null;this.src='https://placehold.co/600x400/ef4444/ffffff?text=Error+al+cargar+imagen';">

                <div id="productDetails"
                     data-product-id="PRD123"
                     data-product-name="Producto Incre√≠ble Pro"
                     data-product-category="Electr√≥nicos Avanzados"
                     data-product-price="99.99"
                     data-product-currency="USD">

                    <h2 class="text-3xl font-semibold text-sky-300 mb-2">Producto Incre√≠ble Pro</h2>
                    <p class="text-slate-300 mb-4">La soluci√≥n definitiva para tus necesidades imaginarias. Con caracter√≠sticas mejoradas y un dise√±o elegante.</p>
                    <p class="text-2xl font-bold text-emerald-400 mb-6">Precio: $99.99 USD</p>
                </div>

                <div class="space-y-4">
                    <button id="addToCartBtn"
                            onclick="handleAddToCart()"
                            class="btn w-full bg-sky-500 hover:bg-sky-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-sky-400 focus:ring-opacity-75">
                        üõí A√±adir al Carrito
                    </button>

                    <button id="beginCheckoutBtn"
                            onclick="handleBeginCheckout()"
                            class="btn w-full bg-amber-500 hover:bg-amber-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-amber-400 focus:ring-opacity-75 hidden">
                        üí≥ Iniciar Pago
                    </button>

                    <button id="purchaseBtn"
                            onclick="handlePurchase()"
                            class="btn w-full bg-emerald-500 hover:bg-emerald-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-emerald-400 focus:ring-opacity-75 hidden">
                        üõçÔ∏è Confirmar Compra
                    </button>
                </div>
            </div>
        </section>

        <section id="messageSection" class="mt-8 text-center">
            <div id="messageBox" class="message-box bg-slate-700 p-4 rounded-lg shadow-md text-slate-300 min-h-[50px] flex items-center justify-center">
                <p>Bienvenido. Selecciona un producto para comenzar.</p>
            </div>
        </section>

         <div class="mt-8 text-center">
            <button id="resetBtn"
                    onclick="resetFlow()"
                    class="btn bg-rose-500 hover:bg-rose-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-rose-400 focus:ring-opacity-75">
                üîÑ Reiniciar Simulaci√≥n
            </button>
        </div>
    </div>

    <script>
        // Referencias a los elementos del DOM
        const productDetailsElement = document.getElementById('productDetails');
        const addToCartBtn = document.getElementById('addToCartBtn');
        const beginCheckoutBtn = document.getElementById('beginCheckoutBtn');
        const purchaseBtn = document.getElementById('purchaseBtn');
        const messageBox = document.getElementById('messageBox');

        // --- Simulaci√≥n de dataLayer de Google Tag Manager ---
        // Es buena pr√°ctica declarar dataLayer ANTES del script de GTM
        // Para este ejemplo, lo simularemos aqu√≠ para que puedas ver los eventos.
        window.dataLayer = window.dataLayer || [];

        function pushToDataLayer(eventData) {
            console.log('Pushing to dataLayer:', eventData); // Para depuraci√≥n en consola
            window.dataLayer.push(eventData);
        }

        // --- Funciones de los Botones ---

        /**
         * Maneja el evento de a√±adir al carrito.
         * Aqu√≠ es donde t√≠picamente enviar√≠as un evento 'add_to_cart' a GTM.
         */
        function handleAddToCart() {
            // Obtener detalles del producto para el dataLayer
            const productData = {
                id: productDetailsElement.dataset.productId,
                name: productDetailsElement.dataset.productName,
                category: productDetailsElement.dataset.productCategory,
                price: parseFloat(productDetailsElement.dataset.productPrice),
                currency: productDetailsElement.dataset.productCurrency,
                quantity: 1 // Asumimos que se a√±ade 1 unidad
            };

            // Simular env√≠o de evento a dataLayer para GTM
            pushToDataLayer({
                event: 'add_to_cart', // Nombre del evento est√°ndar de GA4
                ecommerce: {
                    currency: productData.currency,
                    value: productData.price, // Valor del item a√±adido
                    items: [{
                        item_id: productData.id,
                        item_name: productData.name,
                        item_category: productData.category,
                        price: productData.price,
                        quantity: productData.quantity
                    }]
                }
            });

            // Actualizar UI
            messageBox.innerHTML = `<p class="text-sky-300">‚úÖ "${productData.name}" a√±adido al carrito.</p>`;
            addToCartBtn.classList.add('hidden');
            beginCheckoutBtn.classList.remove('hidden');
            beginCheckoutBtn.focus(); // Mejorar accesibilidad
        }

        /**
         * Maneja el evento de iniciar el proceso de pago.
         * Aqu√≠ es donde t√≠picamente enviar√≠as un evento 'begin_checkout' a GTM.
         */
        function handleBeginCheckout() {
            // Simular env√≠o de evento a dataLayer para GTM
            // Para begin_checkout, usualmente se env√≠an todos los items del carrito.
            // Para este ejemplo simple, asumimos que es el mismo producto.
            const productData = {
                id: productDetailsElement.dataset.productId,
                name: productDetailsElement.dataset.productName,
                category: productDetailsElement.dataset.productCategory,
                price: parseFloat(productDetailsElement.dataset.productPrice),
                currency: productDetailsElement.dataset.productCurrency,
                quantity: 1
            };

            pushToDataLayer({
                event: 'begin_checkout', // Nombre del evento est√°ndar de GA4
                ecommerce: {
                    currency: productData.currency,
                    value: productData.price * productData.quantity, // Valor total del carrito
                    items: [{
                        item_id: productData.id,
                        item_name: productData.name,
                        item_category: productData.category,
                        price: productData.price,
                        quantity: productData.quantity
                    }]
                    // Podr√≠as a√±adir 'coupon' si aplica
                }
            });

            // Actualizar UI
            messageBox.innerHTML = '<p class="text-amber-300">üí≥ Has iniciado el proceso de pago.</p>';
            beginCheckoutBtn.classList.add('hidden');
            purchaseBtn.classList.remove('hidden');
            purchaseBtn.focus();
        }

        /**
         * Maneja el evento de compra.
         * Aqu√≠ es donde t√≠picamente enviar√≠as un evento 'purchase' a GTM.
         */
        function handlePurchase() {
            const transactionId = 'TID' + Date.now(); // ID de transacci√≥n √∫nico (simulado)
            const productData = {
                id: productDetailsElement.dataset.productId,
                name: productDetailsElement.dataset.productName,
                category: productDetailsElement.dataset.productCategory,
                price: parseFloat(productDetailsElement.dataset.productPrice),
                currency: productDetailsElement.dataset.productCurrency,
                quantity: 1
            };

            // Simular env√≠o de evento a dataLayer para GTM
            pushToDataLayer({
                event: 'purchase', // Nombre del evento est√°ndar de GA4
                ecommerce: {
                    transaction_id: transactionId,
                    value: productData.price * productData.quantity, // Valor total de la transacci√≥n
                    tax: productData.price * 0.18, // Ejemplo de impuesto (18%)
                    shipping: 5.00, // Ejemplo de costo de env√≠o
                    currency: productData.currency,
                    coupon: 'SUMMERSALE', // Ejemplo de cup√≥n
                    items: [{
                        item_id: productData.id,
                        item_name: productData.name,
                        item_category: productData.category,
                        price: productData.price,
                        quantity: productData.quantity
                        // item_brand: 'Marca Ejemplo', // Opcional
                        // item_variant: 'Color Rojo', // Opcional
                        // coupon: 'ITEMCOUPON' // Opcional, cup√≥n a nivel de item
                    }]
                }
            });

            // Actualizar UI
            messageBox.innerHTML = `<p class="text-emerald-300">üéâ ¬°Compra completada! Gracias. ID de Transacci√≥n: ${transactionId}</p>`;
            purchaseBtn.classList.add('hidden');
            // Opcionalmente, podr√≠as mostrar un mensaje de "Gracias" y reiniciar.
        }

        /**
         * Reinicia el flujo de compra a su estado inicial.
         */
        function resetFlow() {
            addToCartBtn.classList.remove('hidden');
            beginCheckoutBtn.classList.add('hidden');
            purchaseBtn.classList.add('hidden');
            messageBox.innerHTML = '<p>Bienvenido. Selecciona un producto para comenzar.</p>';
            // Opcional: limpiar el dataLayer o algunas de sus variables si es necesario para la prueba.
            // Por ejemplo, si GTM usa variables del dataLayer que deben resetearse.
            // window.dataLayer.push({'variable_a_limpiar': undefined});
            console.log('Flujo reiniciado');
        }

        // Inicializaci√≥n (si es necesaria alguna l√≥gica al cargar la p√°gina)
        document.addEventListener('DOMContentLoaded', () => {
            console.log('P√°gina de pr√°ctica GTM cargada y lista.');
            // Aqu√≠ podr√≠as enviar un evento 'view_item' si la p√°gina se considera la vista de un producto espec√≠fico.
            const productData = {
                id: productDetailsElement.dataset.productId,
                name: productDetailsElement.dataset.productName,
                category: productDetailsElement.dataset.productCategory,
                price: parseFloat(productDetailsElement.dataset.productPrice),
                currency: productDetailsElement.dataset.productCurrency
            };
            pushToDataLayer({
                event: 'view_item',
                ecommerce: {
                    currency: productData.currency,
                    value: productData.price,
                    items: [{
                        item_id: productData.id,
                        item_name: productData.name,
                        item_category: productData.category,
                        price: productData.price,
                        quantity: 1 // Para view_item, la cantidad suele ser 1
                    }]
                }
            });
        });
    </script>

</body>
</html>
